## アーキテクチャ（現状 / 目標）

### 現状（リポジトリのスケルトン）

- `frontend/`:
  - Bunで静的HTML + Reactを配信
  - 例として`/api/hello`のローカルAPI（フロントのBunサーバー内）を持つ
- `backend/`:
  - Bun + Hono
  - 現状は`GET /`のみ

つまり現状は「フロントとバックが並列に起動できる」ところまでで、学習カリキュラム機能は未実装。

---

## 目標アーキテクチャ（MVP）

### コンポーネント

- **Frontend（Web）**
  - オンボーディング入力UI
  - カリキュラム閲覧（ツリー/週次/日次）
  - 今日のタスク（チェックリスト、学習タイマー、ログ入力）
  - 振り返り（週次サマリー、リプラン提案の採否）
- **Backend（API）**
  - Goal/Curriculum/StudyLogのCRUD
  - AI生成（カリキュラム生成、リプラン、Q&A）
  - ガードレール（安全性/レート制限）
- **DB（永続化）**
  - MVPはSQLiteでも可、成長後はPostgreSQL想定
  - `docs/data_model.md`の論理モデルを格納
- **AI Provider**
  - 外部LLM（OpenAI等）または社内モデル
  - サーバー側で呼び出し（APIキーをクライアントへ出さない）

### 典型的なデータフロー

1. ユーザーがオンボーディング入力（Frontend）
2. `POST /v1/goals`（Backend）でGoal作成
3. `POST /v1/goals/:goalId/curriculums:generate`（Backend）
4. BackendがLLMに生成依頼 → 生成結果を正規化 → DBへ保存
5. Frontendが`GET /v1/curriculums/:id/tree`等で表示
6. 学習後に`POST /v1/study-logs`で実績保存
7. 週次で`/curriculums:replan`を叩いて新versionを作成

---

## 境界（責務の分離）

### Frontendの責務

- 入力/表示/編集のUX
- オフライン/回線不安定時の最低限の入力保持（任意）
- API呼び出し（認証が入る場合はトークン管理）

### Backendの責務

- データの正規化・永続化
- AI呼び出し（プロンプト管理、モデル選択、失敗時再試行）
- 安全性（内容フィルタ、ポリシー、監査ログ）
- 再現性（生成に使ったコンテキストを保存）

---

## 生成設計（AI）

### 生成対象（MVP）

- カリキュラムの章立て（phase/module/lesson/task）
- 各タスクの「目的」「目安時間」「完了条件」
- 遅延時の再計画（Must/Should/Couldの優先順位付け）

### 生成の品質担保（案）

- **構造化出力**: JSONスキーマに沿って生成 → バリデーション
- **正規化**: 時間、日付、並び順、階層構造の整形
- **安全性**: 禁止領域の除外、著作権侵害の抑制

---

## 将来拡張

- **ジョブ化/ストリーミング**: 長い生成を非同期化し、段階表示
- **教材推薦の高度化**: ベクトル検索、ユーザー嗜好学習
- **学習計測の高度化**: 記述式採点、解答過程の分析
- **マルチデバイス**: モバイル最適化、プッシュ通知

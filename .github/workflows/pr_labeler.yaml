name: PR Labeler

on:
  pull_request_target:
    types: [opened, synchronize, reopened, ready_for_review]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  label:
    name: Apply labels based on changed paths
    runs-on: ubuntu-latest
    steps:
      - name: Ensure labels exist
        uses: actions/github-script@v8
        with:
          script: |
            const { owner, repo } = context.repo;
            const labels = [
              { name: "frontend", color: "1d76db", description: "Changes in frontend/" },
              { name: "backend", color: "0e8a16", description: "Changes in backend/" },
              { name: "ci", color: "5319e7", description: "Changes in GitHub Actions / CI" },
              { name: "repo", color: "cfd3d7", description: "Repo/root-level configuration changes" },
            ];

            for (const label of labels) {
              try {
                await github.rest.issues.createLabel({
                  owner,
                  repo,
                  name: label.name,
                  color: label.color,
                  description: label.description,
                });
                core.info(`Created label: ${label.name}`);
              } catch (e) {
                const status = e?.status;
                if (status === 422) {
                  core.info(`Label already exists: ${label.name}`);
                  continue;
                }
                throw e;
              }
            }

      - name: Label PR
        uses: actions/labeler@v6.0.1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          configuration-path: .github/labeler.yml
          sync-labels: true
